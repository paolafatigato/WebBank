<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SchoolLedger - Home</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1>SchoolLedger</h1>
        <p>Home — seleziona la classe</p>
      </div>
      <div style="margin-left:auto" class="small">Dati locali nel browser — esporta/importa per backup</div>
    </div>

    <div class="card">
      <div class="row">
        <button class="btn" onclick="location.href='class.html?c=1A'">1A</button>
        <button class="btn secondary" onclick="alert('Altre classi verranno aggiunte più avanti')">1B</button>
        <button class="btn ghost" onclick="alert('Vuoi aggiungere una nuova classe? Modificheremo i file')">+ Aggiungi classe</button>
        <div style="margin-left:auto" class="small">Per ora: demo 1A</div>
      </div>

      <hr style="margin:12px 0">

      <div>
        <strong>Backup / Ripristino</strong>
        <div class="controls" style="margin-top:8px">
          <input id="importFile" type="file" accept=".json" class="input">
          <button class="btn" id="exportBtn">Export JSON</button>
          <button class="btn ghost" id="resetBtn">Reset dati locali</button>
        </div>
        <div id="msg" class="status"></div>
      </div>
    </div>

  </div>

<script src="script.js"></script>
<script>
  // export/reset logic on home
  document.getElementById('exportBtn').addEventListener('click', ()=> {
    const db = loadDB();
    const blob = new Blob([JSON.stringify(db,null,2)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'schoolledger_backup.json'; a.click();
    URL.revokeObjectURL(url);
    showHomeMessage('Export eseguito', 'ok');
  });

  document.getElementById('importFile').addEventListener('change', async (e)=>{
    const f = e.target.files[0]; if(!f) return;
    const text = await f.text();
    try{
      const parsed = JSON.parse(text);
      if(confirm('Sovrascrivere i dati locali con il file importato?')) {
        saveDB(parsed);
        showHomeMessage('Import OK', 'ok');
      }
    }catch(err){ showHomeMessage('Errore import: '+err.message, 'err'); }
    e.target.value='';
  });

  document.getElementById('resetBtn').addEventListener('click', ()=>{
    if(confirm('Resettare tutti i dati locali?')) {
      localStorage.removeItem('schoolledger_db_v1');
      location.reload();
    }
  });

  function showHomeMessage(m,t){
    const el = document.getElementById('msg');
    el.textContent = m; el.classList.add('show');
    el.style.background = t==='err' ? '#ffdede' : '#e8ffe8';
    setTimeout(()=> el.classList.remove('show'), 2500);
  }
</script>
</body>
</html>
